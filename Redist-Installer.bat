@echo off
:: Permalink: https://git.io/redists


:: Run as Admin
set "params=%*"
cd /d "%~dp0" && ( if exist "%temp%\getadmin.vbs" del "%temp%\getadmin.vbs" ) && fsutil dirty query %systemdrive% 1>nul 2>nul || (  echo Set UAC = CreateObject^("Shell.Application"^) : UAC.ShellExecute "cmd.exe", "/k cd ""%~sdp0"" && %~s0 %params%", "", "runas", 1 >> "%temp%\getadmin.vbs" && "%temp%\getadmin.vbs" && exit /B )

title Redist Installer

md %temp%\Redist-Installer >nul 2>&1

if exist "7za.dll" (
    if exist "7za.exe" (
        if exist "redists.zip" (
            move /Y 7za.dll %temp%\Redist-Installer >nul
            move /Y 7za.exe %temp%\Redist-Installer >nul
            move /Y redists.zip %temp%\Redist-Installer >nul
            goto offlineInstall
        )
    )
) else (
    goto onlineInstall
)

:onlineInstall
cd %temp%\Redist-Installer
echo Downloading 1/3...
powershell -Command "(New-Object Net.WebClient).DownloadFile('https://github.com/chxseh/Redist-Installer/releases/download/latest/7za.dll', '7za.dll')"
echo Downloading 2/3...
powershell -Command "(New-Object Net.WebClient).DownloadFile('https://github.com/chxseh/Redist-Installer/releases/download/latest/7za.exe', '7za.exe')"
echo Downloading 3/3...
powershell -Command "(New-Object Net.WebClient).DownloadFile('https://github.com/chxseh/Redist-Installer/releases/download/latest/redists.zip', 'redists.zip')"

:offlineInstall
cd %temp%\Redist-Installer
:: Extract Redists
start /wait /min 7za.exe e redists.zip -y

:: Legacy Downloads (M$ has pulled multiple of these recently.)
:: Some of the following files are pulled from Discord's CDN. This is because they have been pulled from M$'s website multiple times in the past.
@REM echo Downloading 1/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://aka.ms/vs/16/release/vc_redist.x86.exe', 'vcredist2015_2017_2019_x86.exe')"
@REM echo Downloading 2/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://aka.ms/vs/16/release/vc_redist.x64.exe', 'vcredist2015_2017_2019_x64.exe')"
@REM echo Downloading 3/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://aka.ms/highdpimfc2013x64enu', '2013_x64.exe')"
@REM echo Downloading 4/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://aka.ms/highdpimfc2013x86enu', '2013_x86.exe')"
@REM echo Downloading 5/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/1/6/B/16B06F60-3B20-4FF2-B699-5E9B7962F9AE/VSU_4/vcredist_x64.exe', '2012_x64.exe')"
@REM echo Downloading 6/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/1/6/B/16B06F60-3B20-4FF2-B699-5E9B7962F9AE/VSU_4/vcredist_x86.exe', '2012_x86.exe')"
@REM echo Downloading 7/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/5/B/C/5BC5DBB3-652D-4DCE-B14A-475AB85EEF6E/vcredist_x86.exe', '2010_x86.exe')"
@REM echo Downloading 8/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/3/2/2/3224B87F-CFA0-4E70-BDA3-3DE650EFEBA5/vcredist_x64.exe', '2010_x64.exe')"
@REM echo Downloading 9/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://cdn.discordapp.com/attachments/710609237805498500/839636091417919488/2008_x86.exe', '2008_x86.exe')"
@REM echo Downloading 10/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://cdn.discordapp.com/attachments/710609237805498500/839636081263640586/2008_x64.exe', '2008_x64.exe')"
@REM echo Downloading 11/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/8/B/4/8B42259F-5D70-43F4-AC2E-4B208FD8D66A/vcredist_x86.EXE', '2005_x86.exe')"
@REM echo Downloading 12/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://download.microsoft.com/download/8/B/4/8B42259F-5D70-43F4-AC2E-4B208FD8D66A/vcredist_x64.EXE', '2005_x64.exe')"
@REM echo Downloading 13/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://cdn.discordapp.com/attachments/710609237805498500/804707669428535366/dxwebsetup.exe', 'DirectX.exe')"
@REM echo Downloading 14/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://cdn.discordapp.com/attachments/710609237805498500/785666488219992084/DX90c_Addon_Installer.exe', 'DirectXA.exe')"
@REM echo Downloading 15/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://go.microsoft.com/fwlink/?LinkId=863262', 'dotNET.exe')"
@REM echo Downloading 16/16...
@REM powershell -Command "(New-Object Net.WebClient).DownloadFile('https://cdn.discordapp.com/attachments/710609237805498500/1004773678103404686/msxmlenu.msi', 'msxmlenu.msi')"

echo Installing 1/16...
vcredist2015_2017_2019_x86.exe /install /quiet /norestart
echo Installing 2/16...
vcredist2015_2017_2019_x64.exe /install /quiet /norestart
echo Installing 3/16...
2013_x86.exe /install /quiet /norestart
echo Installing 4/16...
2013_x64.exe /install /quiet /norestart
echo Installing 5/16...
2012_x86.exe /install /quiet /norestart
echo Installing 6/16...
2012_x64.exe /install /quiet /norestart
echo Installing 7/16...
2010_x86.exe /install /quiet /norestart
echo Installing 8/16...
2010_x64.exe /install /quiet /norestart
echo Installing 9/16...
2008_x86.exe /install /quiet /norestart
echo Installing 10/16...
2008_x64.exe /install /quiet /norestart
echo Installing 11/16...
2005_x86.exe /Q
echo Installing 12/16...
2005_x64.exe /Q
echo Installing 13/16...
start /wait DirectX.exe /Q
echo Installing 14/16...
start /wait DirectXA.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /SP-
echo Installing 15/16...
start /wait dotNET.exe /Q
echo Installing 16/16...
start /wait msxmlenu.msi /qn /L* "%temp%\XML Parser 4.0.log" /norestart ALLUSERS=2 >nul 2>&1

cd %temp%
rmdir %temp%\Redist-Installer /s /q
exit
